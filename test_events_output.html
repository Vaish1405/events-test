<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="./eventsAccessible.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@3.0.8/dist/css/splide.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@3.0.8/dist/js/splide.min.js"></script>

  <title>Events Carousel</title>
</head>

<body>
  <section id="image-carousel"
    class="splide"
    role="group"
    aria-roledescription="carousel"
    aria-label="Upcoming CSUN Events">
    
    <div class="splide__track" id="image-carousel-track" role="region">
      <ul class="splide__list">
        
        <li class="splide__slide"
            role="group"
            aria-roledescription="slide"
            aria-label="1 of 5">
          <a
            style="all: unset;"
            class="event__link"
            href="https://example.com/event1"
            target="_blank"
            aria-label="Matador Morning Bash"
            data-title="Matador Morning Bash"
            data-full="Matador Morning Bash. Date: JUL 10. Time: 09:00 AM - 11:00 AM. Location: CSUN Library Lawn.">
            
            <div class="box card-select" aria-hidden="true">
              <img src="https://itdocs.csun.edu/mobile-redesign/images/lib.png" alt="Matador Morning Bash image" />
              <div class="overlay"></div>
              <div class="h3">
                <span class="title" id="event-title-1">Matador Morning Bash</span>
              </div>
              <div class="details">
                <div class="date">JUL 10</div>
                <div class="time"><strong>Time: </strong>09:00 AM - 11:00 AM</div>
                <div class="location"><strong>Location: </strong>CSUN Library Lawn</div>
              </div>
            </div>
          </a>
        </li>
        
        <li class="splide__slide"
            role="group"
            aria-roledescription="slide"
            aria-label="2 of 5">
          <a
            style="all: unset;"
            class="event__link"
            href="https://example.com/event2"
            target="_blank"
            aria-label="Tech Career Fair"
            data-title="Tech Career Fair"
            data-full="Tech Career Fair. Date: JUL 12. Time: 12:00 PM - 04:00 PM. Location: USU Grand Salon.">
            
            <div class="box card-select" aria-hidden="true">
              <img src="https://itdocs.csun.edu/mobile-redesign/images/usu.png" alt="Tech Career Fair image" />
              <div class="overlay"></div>
              <div class="h3">
                <span class="title" id="event-title-2">Tech Career Fair</span>
              </div>
              <div class="details">
                <div class="date">JUL 12</div>
                <div class="time"><strong>Time: </strong>12:00 PM - 04:00 PM</div>
                <div class="location"><strong>Location: </strong>USU Grand Salon</div>
              </div>
            </div>
          </a>
        </li>
        
        <li class="splide__slide"
            role="group"
            aria-roledescription="slide"
            aria-label="3 of 5">
          <a
            style="all: unset;"
            class="event__link"
            href="https://example.com/event3"
            target="_blank"
            aria-label="AI in Education Panel"
            data-title="AI in Education Panel"
            data-full="AI in Education Panel. Date: JUL 15. Time: 03:00 PM - 04:30 PM. Location: Online.">
            
            <div class="box card-select" aria-hidden="true">
              <img src="https://itdocs.csun.edu/mobile-redesign/images/default.png" alt="AI in Education Panel image" />
              <div class="overlay"></div>
              <div class="h3">
                <span class="title" id="event-title-3">AI in Education Panel</span>
              </div>
              <div class="details">
                <div class="date">JUL 15</div>
                <div class="time"><strong>Time: </strong>03:00 PM - 04:30 PM</div>
                <div class="location"><strong>Location: </strong>Online</div>
              </div>
            </div>
          </a>
        </li>
        
        <li class="splide__slide"
            role="group"
            aria-roledescription="slide"
            aria-label="4 of 5">
          <a
            style="all: unset;"
            class="event__link"
            href="https://example.com/event4"
            target="_blank"
            aria-label="Clubs & Orgs Info Night"
            data-title="Clubs & Orgs Info Night"
            data-full="Clubs & Orgs Info Night. Date: JUL 17. Time: 05:00 PM - 06:30 PM. Location: Oviatt Lawn.">
            
            <div class="box card-select" aria-hidden="true">
              <img src="https://itdocs.csun.edu/mobile-redesign/images/lib.png" alt="Clubs & Orgs Info Night image" />
              <div class="overlay"></div>
              <div class="h3">
                <span class="title" id="event-title-4">Clubs & Orgs Info Night</span>
              </div>
              <div class="details">
                <div class="date">JUL 17</div>
                <div class="time"><strong>Time: </strong>05:00 PM - 06:30 PM</div>
                <div class="location"><strong>Location: </strong>Oviatt Lawn</div>
              </div>
            </div>
          </a>
        </li>
        
        <li class="splide__slide"
            role="group"
            aria-roledescription="slide"
            aria-label="5 of 5">
          <a
            style="all: unset;"
            class="event__link"
            href="https://example.com/event5"
            target="_blank"
            aria-label="Sustainability Meetup"
            data-title="Sustainability Meetup"
            data-full="Sustainability Meetup. Date: JUL 20. Time: 10:00 AM - 11:30 AM. Location: CSUN Sustainability Center.">
            
            <div class="box card-select" aria-hidden="true">
              <img src="https://itdocs.csun.edu/mobile-redesign/images/usu.png" alt="Sustainability Meetup image" />
              <div class="overlay"></div>
              <div class="h3">
                <span class="title" id="event-title-5">Sustainability Meetup</span>
              </div>
              <div class="details">
                <div class="date">JUL 20</div>
                <div class="time"><strong>Time: </strong>10:00 AM - 11:30 AM</div>
                <div class="location"><strong>Location: </strong>CSUN Sustainability Center</div>
              </div>
            </div>
          </a>
        </li>
        
      </ul>
    </div>

    <div class="splide__arrows">
      <button class="splide__arrow splide__arrow--prev"
        type="button"
        aria-controls="image-carousel-track"
        aria-label="Previous slide">
        <span>&#10094;</span>
      </button>
      <button class="splide__arrow splide__arrow--next"
        type="button"
        aria-controls="image-carousel-track"
        aria-label="Next slide">
        <span>&#10095;</span>
      </button>
    </div>
  </section>

  <div id="event-live-region" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const splide = new Splide('.splide', {
        pagination: false,
        slideFocus: false,
        waitForTransition: false,
      }).mount();

      const slides = document.querySelectorAll('.splide__slide');
      const liveRegion = document.getElementById('event-live-region');
      const prevButton = document.querySelector('.splide__arrow--prev');
      const nextButton = document.querySelector('.splide__arrow--next');

      // Track if we're moving focus due to edge navigation to prevent duplicate announcements
      let isEdgeNavigation = false;

      function updateLiveRegion(newIndex) {
        const slide = slides[newIndex];
        const link = slide?.querySelector('.event__link');
        const title = link?.dataset.title;
        if (liveRegion && title) {
          liveRegion.textContent = title;
        }
      }

      function focusActiveSlideIfEdge() {
        const index = splide.index;
        const total = splide.length;
        
        // Check if we're at the edges and the corresponding button is disabled
        const isAtFirstSlide = index === 0;
        const isAtLastSlide = index === total - 1;
        const prevButtonDisabled = prevButton.disabled;
        const nextButtonDisabled = nextButton.disabled;

        // Move focus to slide content if we're at an edge and the button is disabled
        if ((isAtFirstSlide && prevButtonDisabled) || (isAtLastSlide && nextButtonDisabled)) {
          const slide = splide.Components.Slides.getAt(index).slide;
          const link = slide?.querySelector('.event__link');
          if (link) {
            isEdgeNavigation = true;
            link.focus({ preventScroll: true });
            
            // Reset the flag after a short delay to allow focus event to process
            setTimeout(() => {
              isEdgeNavigation = false;
            }, 100);
          }
        }
      }

      // Monitor arrow button state changes
      function checkArrowButtonStates() {
        const index = splide.index;
        const total = splide.length;
        
        // Check if buttons should be disabled
        const shouldPrevBeDisabled = index === 0;
        const shouldNextBeDisabled = index === total - 1;
        
        // Update button states
        if (shouldPrevBeDisabled && !prevButton.disabled) {
          prevButton.disabled = true;
          // If focus was on the prev button, move it to slide content
          if (document.activeElement === prevButton) {
            focusActiveSlideIfEdge();
          }
        } else if (!shouldPrevBeDisabled && prevButton.disabled) {
          prevButton.disabled = false;
        }
        
        if (shouldNextBeDisabled && !nextButton.disabled) {
          nextButton.disabled = true;
          // If focus was on the next button, move it to slide content
          if (document.activeElement === nextButton) {
            focusActiveSlideIfEdge();
          }
        } else if (!shouldNextBeDisabled && nextButton.disabled) {
          nextButton.disabled = false;
        }
      }

      splide.on('moved', function (newIndex) {
        updateLiveRegion(newIndex);
        setTimeout(() => {
          checkArrowButtonStates();
          focusActiveSlideIfEdge();
        }, 50);
      });

      slides.forEach((slide) => {
        const link = slide.querySelector('.event__link');
        if (!link) return;
        const full = link.dataset.full;
        const title = link.dataset.title;

        link.addEventListener('focus', () => {
          link.setAttribute('aria-label', full);
          
          // Only announce via live region if this is not edge navigation
          if (!isEdgeNavigation) {
            if (liveRegion && title) {
              liveRegion.textContent = title;
            }
          }
        });

        link.addEventListener('blur', () => {
          link.setAttribute('aria-label', title);
        });
      });

      // Initialize button states and live region
      checkArrowButtonStates();
      splide.emit('moved', splide.index);
    });
  </script>
</body>

</html>
